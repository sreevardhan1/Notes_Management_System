<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Flash Notes{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/Notes_logo.png') }}">


  <link rel="stylesheet" href="{{ url_for('static', filename='CSS/style.css') }}">
</head>

<body data-theme="light">
<nav class="navbar navbar-expand-lg sticky-top">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="{{ url_for('view_all') }}">
      <img src="{{ url_for('static', filename='images/Notes_logo.png') }}" alt="Flash Notes Logo"
           style="height:35px; width:35px; border-radius:50%; margin-right:8px;">
      <span class="fw-bold text-light">Flash Notes</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="nav">
      <ul class="navbar-nav ms-auto align-items-center">
        <!-- Search (GET)
         {% if session.get('user_id') %}
          <form class="d-flex me-3" action="{{ url_for('search_notes') }}" method="get">
          <input class="form-control form-control-sm me-2" type="search" name="q" placeholder="Search notes..." aria-label="Search" value="{{ request.args.get('q','') }}">
          <button class="btn btn-outline-light btn-sm" type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
          </form>
        {% endif %} -->
        
        {% if session.get('username') %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('add_note') }}"><i class="fa-solid fa-plus"></i> Add Note</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('view_all') }}">Notes</a></li>
          <li class="nav-item"><a class="nav-link text-danger" href="{{ url_for('logout') }}"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
        {% else %}
        {% if request.endpoint not in ['login','register','forgot','reset_password'] %}
            <li class="nav-item"><a class="nav-link" href="{{ url_for('login') }}">Login</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('register') }}">Register</a></li>
        {% endif %}
        {% endif %}

        <li class="nav-item"><a class="nav-link" href="{{ url_for('about') }}">About</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('contact') }}">Contact</a></li>

        <li class="nav-item ms-3">
          <button id="themeToggle" class="btn btn-outline-secondary btn-sm" title="Toggle theme">
            <i id="themeIcon" class="bi bi-moon-fill"></i>
          </button>
        </li>
      </ul>
    </div>
  </div>
</nav>


<div class="container mt-3">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for cat,msg in messages %}
        <div class="alert alert-{{ cat }} alert-dismissible fade show flash-message" role="alert">
          {{ msg }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
</div>

<main class="container py-4">
  {% block content %}{% endblock %}
</main>

<footer class="text-center py-3 mt-auto">
  <div class="container">
    <p class="mb-1">© 2025 Sree Inc.</p>
    <p class="small mb-0">Built with ❤️ using Flask, MySQL, Bootstrap</p>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
  // Confetti on flash
  document.querySelectorAll('.flash-message').forEach(m=>{
    confetti({ particleCount: 60, spread: 60, origin: { y: 0.6 }});
  });

  // Theme toggle with persistence
  const toggleBtn = document.getElementById('themeToggle');
  const themeIcon = document.getElementById('themeIcon');
  const stored = localStorage.getItem('theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
  document.body.setAttribute('data-theme', stored);
  themeIcon.className = stored === 'dark' ? 'bi bi-sun-fill' : 'bi bi-moon-fill';

  toggleBtn.addEventListener('click', ()=>{
    const newTheme = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
    document.body.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    themeIcon.className = newTheme === 'dark' ? 'bi bi-sun-fill' : 'bi bi-moon-fill';
  });
</script>

<!-- Loading Overlay -->
<div id="loadingOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:9999; justify-content:center; align-items:center;">
  <div class="spinner-border text-light" role="status" style="width:4rem; height:4rem;">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>

<script>
// Show loading on form submissions
document.querySelectorAll('form').forEach(form => {
  form.addEventListener('submit', (e) => {
    if (!form.checkValidity()) return;
    document.getElementById('loadingOverlay').style.display = 'flex';
  });
});
</script>
</body>
</html>
